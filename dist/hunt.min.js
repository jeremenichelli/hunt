(function(root,factory){"use strict";if(typeof define==="function"&&define.amd){define(function(){return factory()})}else if(typeof exports==="object"){module.exports=factory()}else{root.hunt=factory()}})(this,function(){"use strict";var huntedElements=[],viewport=window.innerHeight,THROTTLE_INTERVAL=100;var Hunted=function(element,config){this.element=element;this.visible=false;for(var prop in config){if(config.hasOwnProperty(prop)){this[prop]=config[prop]}}if(typeof element.dataset.huntPersist!=="undefined"){try{this.persist=JSON.parse(element.dataset.huntPersist)}catch(e){console.log("Invalid data-hunt-persist value",e)}}if(typeof element.dataset.huntOffset!=="undefined"){try{this.offset=JSON.parse(element.dataset.huntOffset)}catch(e){console.log("Invalid data-hunt-offset value",e)}}};var noop=function(){};Hunted.prototype.offset=0;Hunted.prototype.persist=false;Hunted.prototype.enter=noop;Hunted.prototype.out=noop;var add=function(elements,options){if(elements instanceof Node===false&&typeof elements.length!=="number"||typeof options!=="object"){throw new TypeError("Arguments must be an element or a list of them and an object")}if(elements instanceof Node===true){elements=[elements]}var i=0,len=elements.length;if(huntedElements.length===0){window.addEventListener("resize",resizeThrottled);window.addEventListener("scroll",scrollThrottled)}for(;i<len;i++){huntedElements.push(new Hunted(elements[i],options))}huntElements();i=len=null};var updateMetrics=function(){viewport=window.innerHeight;huntElements()};var clear=function(){huntedElements=[];window.removeEventListener("resize",resizeThrottled);window.removeEventListener("scroll",scrollThrottled)};add.clear=clear;var huntElements=function(){var len=huntedElements.length,hunted,rect;while(len){--len;hunted=huntedElements[len];rect=hunted.element.getBoundingClientRect();if(!hunted.visible&&rect.top-hunted.offset<viewport&&rect.top>=-(rect.height+hunted.offset)){hunted.enter.apply(hunted.element);hunted.visible=true}if(hunted.visible&&(rect.top-hunted.offset>=viewport||rect.top<=-(rect.height+hunted.offset))){hunted.out.apply(hunted.element);hunted.visible=false;if(!hunted.persist){huntedElements.splice(len,1);if(huntedElements.length===0){window.removeEventListener("resize",resizeThrottled);window.removeEventListener("scroll",scrollThrottled)}}}}hunted=len=null};add.trigger=huntElements;var throttle=function(fn){var timer=null;return function(){if(timer){return}timer=setTimeout(function(){fn.apply(this,arguments);timer=null},THROTTLE_INTERVAL)}};var resizeThrottled=throttle(updateMetrics);var scrollThrottled=throttle(huntElements);return add});
